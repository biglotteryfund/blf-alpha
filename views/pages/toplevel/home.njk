{% from "../../components/caseStudy.njk" import caseStudy %}
{% from "../../components/forms.njk" import textInput, radios with context %}
{% from "../../components/hero.njk" import homepageSuperHero %}
{% from "../../components/news.njk" import articleTeaser with context %}
{% import "../../components/headers.njk" as headers %}

{% extends "../../layouts/main.njk" %}

{% set bodyClass = "has-full-bleed-header" %}
{% set globalFootnote = "* " + __('global.footerLinks.grantFootnote') %}

{% block title %}{{ title }} | {% endblock %}

{% set socialImage = heroImage.default %}

{% block content %}
    {{
        homepageSuperHero(
            copy = copy.hero,
            imageDefault = heroImage.default,
            imageCandidates = heroImage.candidates
        )
    }}

    <article role="main">
        <div class="inner">
            {# case studies #}
            <div class="carousel js-carousel
                swiper-container
                accent--blue a--border-top"
                data-name="Case-studies carousel"
                data-per-page="1">
                <div class="carousel__controls">
                    <button class="btn--carousel btn--carousel--round btn--carousel--prev js-carousel-prev">
                        {% include "../../includes/svg/arrow-left.svg" %}
                        <span class="u-visually-hidden">{{ __('global.accessibility.previousItem') }}</span>
                    </button>
                    <button class="btn--carousel btn--carousel--round btn--carousel--next js-carousel-next">
                        {% include "../../includes/svg/arrow-right.svg" %}
                        <span class="u-visually-hidden">{{ __('global.accessibility.nextItem') }}</span>
                    </button>
                </div>

                <ul class="swiper-wrapper unstyled">
                    {% for c in copy.caseStudies %}
                        <li class="swiper-slide">
                            {{
                                caseStudy(
                                    quoteText = c.quoteText,
                                    quoteName = c.quoteName,
                                    quoteNameCaption = c.quoteNameCaption,
                                    projectName = c.projectName,
                                    imageUrl = c.imageUrl,
                                    imageSmallUrl = c.imageSmallUrl,
                                    link = c.link
                                )
                            }}
                        </li>
                    {% endfor %}
                </ul>

            </div>

            {# funding finder #}
            <div class="central-gap">
                <a href="{{ buildUrl('funding/search-past-grants') }}"
                   class="btn btn--block accent--blue a--btn spaced">{{ copy.browseFundedProjects }}</a>
            </div>

            {# News Posts #}
            {% if news.length %}
                <section class="accent--blue a--border-top">
                    <div class="padded padded--wide-only">
                        <h3 class="t1 t--underline a--text accent--blue">{{ copy.latestNews }}</h3>
                        <ul class="unstyled grid grid--3-up grid--padded--large grid--equal grid--wide-only">
                            {% for article in news %}
                                <li class="grid__item">
                                    {{ articleTeaser(article) }}
                                </li>
                            {% endfor %}
                        </ul>
                    </div>
                </section>
            {% endif %}

        </div>

        <div class="inner--wide-only spaced">
            {# tweets #}
            {% set twitterAccount = appData.config.get('social.twitterAccounts.' + locale)  %}
            <ul class="unstyled grid grid--wide-only grid--equal">
                <li class="grid__item grid__item--large accent--blue a--border-top padded">
                    <a class="twitter-timeline" href="https://twitter.com/{{ twitterAccount }}" data-tweet-limit="3" data-chrome="noheader">Tweets by {{ twitterAccount }}</a> <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
                </li>
                <li class="grid__item accent--pink a--border-top">
                    <form class="form-ebulletin padded spaced" id="{{ anchors.ebulletin }}" method="post" action="/ebulletin">
                        <h3 class="t1 t--underline accent--pink a--text">{{ copy.ebulletin.title }}</h3>
                        {% if request.flash and request.flash('ebulletinStatus') %}
                            {% if request.flash('ebulletinStatus') === 'success' %}
                                <h5 class="t5">{{ copy.ebulletin.responses.success.title }}</h5>
                                <p class="t8">{{ copy.ebulletin.responses.success.body | safe }}</p>
                            {% else %}
                                <h5 class="t5">{{ copy.ebulletin.responses.error.title }}</h5>
                                <p class="t8">{{ copy.ebulletin.responses.error.body }}</p>
                            {% endif %}
                        {% else %}
                            <input type="hidden" name="_csrf" value="{{ csrfToken }}">
                            <input type="hidden" name="locale" value="{{ locale }}">
                            <p class="intro">{{ copy.ebulletin.intro}}</p>
                            <div class="form-ebulletin--grid" role="group" aria-labelledby="aria-form-loc">
                                <span class="u-visually-hidden" id="aria-form-loc">{{ copy.ebulletin.location }}</span>
                                {{ radios(
                                    fieldName = 'location',
                                    options = [
                                        {
                                            name: copy.ebulletin.locations.england,
                                            value: 'ENGLAND_MAIL'
                                        },
                                        {
                                            name: copy.ebulletin.locations.wales,
                                            value: 'WALES_MAIL'
                                        },
                                        {
                                            name: copy.ebulletin.locations.scotland,
                                            value: 'SCOTLAND_MAIL'
                                        },
                                        {
                                            name: copy.ebulletin.locations.northernIreland,
                                            value: 'NI_MAIL'
                                        }
                                    ]
                                ) }}
                            </div>

                            <div class="grid form-ebulletin__fields">
                                {{ textInput(
                                    fieldName = 'firstName',
                                    fieldLabel = copy.ebulletin.fields.firstName,
                                    inputType = 'text',
                                    required = true,
                                    extraClasses = 'grid__item grid__item--half'
                                ) }}

                                {{ textInput(
                                    fieldName = 'lastName',
                                    fieldLabel = copy.ebulletin.fields.lastName,
                                    inputType = 'text',
                                    required = true,
                                    extraClasses = 'grid__item grid__item--half'
                                ) }}
                            </div>

                            {{ textInput(
                                fieldName = 'organisation',
                                fieldLabel = copy.ebulletin.fields.organisation,
                                inputType = 'text',
                                required = false,
                                extraClasses = 'no-gap'
                            ) }}

                            {{ textInput(
                                fieldName = 'email',
                                fieldLabel = copy.ebulletin.fields.emailAddress,
                                inputType = 'email',
                                required = true
                            ) }}

                            <input type="submit" value="{{ copy.ebulletin.callToAction }}"
                                   class="btn btn--small btn--block-full accent--pink a--btn form-ebulletin__btn"/>
                        {% endif %}
                    </form>

                    {# social buttons #}
                    <div class="o-button-group-block u-gutter-half">
                        <a class="btn btn--small btn--outline accent--blue"
                            href="{{ appData.config.get('social.instagram') }}">
                            <span class="btn__icon">{% include "../../includes/svg/instagram.svg" %}</span>
                            {{ copy.social.followUsOn }} {{ copy.social.instagram }}
                        </a>
                        <a class="btn btn--small btn--outline accent--blue"
                            href="{{ appData.config.get('social.facebookAccounts.' + locale) }}">
                            <span class="btn__icon">{% include "../../includes/svg/facebook.svg" %}</span>
                            {{ copy.social.followUsOn }} {{ copy.social.facebook }}
                        </a>
                        <a class="btn btn--small btn--outline accent--blue"
                            href="https://www.twitter.com/{{ appData.config.get('social.twitterAccounts.' + locale) }}" >
                            <span class="btn__icon">{% include "../../includes/svg/twitter.svg" %}</span>
                            {{ copy.social.followUsOn }} {{ copy.social.twitter }}
                        </a>
                    </div>

                </li>
            </ul>

        </div>
    </article>

{% endblock %}
