{% import "./forms.njk" as forms %}
{% from "components/icons.njk" import iconClose %}

{% macro showSurvey() %}
    <div class="survey"
        v-bind:class="{ 'is-active': isActivated }"
        id="js-survey-container"
        v-if="!surveyBlocked"
        v-cloak>
        <form
            class="survey__form"
            method="post"
            :action="'/survey/' + survey.id"
            v-on:submit.prevent="submitSurvey"
        >
            <h6 class="survey__header"
                v-on:click="toggleSurvey()">
                <% localeify(survey, 'question', '{{ locale }}') %><span class="survey__arrow js-survey-arrow">{% include "../includes/svg/arrow-down.svg" %}</span>
            </h6>

            <span class="survey__close-icon"
                v-on:click="blockSurvey()">
                {{ iconClose() }}
            </span>

            <p class="survey__response"
                v-if="isComplete">
                <span v-if="isComplete == 'success'">{{ __('global.surveys.response.success') }}</span>
                <span v-if="isComplete == 'error'">{{ __('global.surveys.response.error') }}</span>
            </p>

            <fieldset class="survey__form-items" v-if="isActivated && !isComplete">
                <button
                    v-for="choice in survey.choices"
                    class="btn btn--small survey__btn survey__btn--choice"
                    :type="(choice.allow_message) ? 'button' : 'submit'"
                    v-on:click="toggleMessage(choice)"
                    v-if="!showMessageBox"
                >
                    <% localeify(choice, 'title', '{{ locale }}') %>
                </button>

                <div class="survey__extra"
                    v-for="choice in survey.choices"
                    v-if="choice.allow_message && showMessageBox"
                >
                    <div class="survey__extra-message">
                        <label for="survey-extra-msg"
                            class="survey__label">
                            {{ __('global.surveys.genericQuestion') }}
                        </label>
                        <textarea
                            class="survey__textbox"
                            id="survey-extra-msg"
                            placeholder="{{ __('global.surveys.genericPrompt') }}"
                            v-model="formData.message"
                            v-on:focus="messageOnFocus"
                            v-on:blur="messageOnBlur"
                        >
                        </textarea>
                    </div>
                    {# submit the survey as a "no" #}
                    <div class="survey__extra-submit">
                        <button type="submit"
                            class="btn btn--small survey__btn"
                            v-on:click="updateChoice(choice)"
                        >
                            {{ __('global.forms.submit') }}
                        </button>
                    </div>
                </div>

            </fieldset>
        </form>
    </div>
{% endmacro %}
