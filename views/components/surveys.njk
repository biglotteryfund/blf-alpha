{% import "./forms.njk" as forms %}

{% macro showSurvey() %}
    <form id="js-survey-container"
          class="survey"
          v-bind:class="{ 'is-active': isActivated }"
          method="post"
          :action="'/survey/' + survey.id"
          v-on:submit.prevent="submitSurvey"
          v-cloak>
        <h6 class="survey__header"
            v-on:click="activateSurvey()">
            <% localeify(survey, 'question', '{{ locale }}') %><span class="survey__arrow js-survey-arrow">{% include "../includes/svg/arrow-down.svg" %}</span>
        </h6>

        <aside class="survey__response"
               v-if="isComplete">
            <p v-if="isComplete == 'success'">Thank you for sharing your feedback with us &ndash; we appreciate your time.</p>
            <p v-if="isComplete == 'error'">We're sorry, there was an error recording your response. Please try again.</p>
        </aside>

        <fieldset v-if="isActivated && !isComplete">
            <button v-for="choice in survey.choices"
                    class="btn btn--small survey__btn"
                    :type="(choice.allow_message) ? 'button' : 'submit'"
                    v-on:click="toggleMessage(choice)"
                    v-if="!showMessageBox">
                <% localeify(choice, 'title', '{{ locale }}') %>
            </button>

            <div v-for="choice in survey.choices"
                 v-if="choice.allow_message && showMessageBox">
                <div class="grid grid--padded survey__extra">
                    {# prompt for more info #}
                    <div class="grid__item">
                        <textarea placeholder="Tell us how we could improve this page..."
                                  class="form-fund__item"
                                  v-model="formData.message">
                        </textarea>
                    </div>
                    {# submit the survey as a "no" #}
                    <div class="grid__item survey__submit">
                        <button type="submit"
                                class="btn btn--small survey__btn"
                                v-on:click="updateChoice(choice)">
                            Submit
                        </button>
                    </div>
                </div>
            </div>

        </fieldset>
    </form>
{% endmacro %}
