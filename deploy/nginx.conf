# Enable Passenger
include /etc/nginx/passenger.conf;
client_max_body_size 50M;
passenger_core_file_descriptor_ulimit 50000;

# Switch on gzip for static assets
gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

# Configure logging in JSON format for Cloudwatch
log_format logger-json escape=json '{'
    '"time_local":"$time_local",'
    '"server":"$host",'
    '"http_method":"$request_method",'
    '"uri_path":"$uri",'
    '"uri_query":"$query_string",'
    '"status":"$status",'
    '"request_time":"$request_time",'
    '"response_time":"$upstream_response_time",'
    '"bytes_in":"$upstream_response_length",'
    '"bytes_out":"$body_bytes_sent",'
    '"http_x_forwarded_for":"$http_x_forwarded_for",'
    '"cookie":"$http_cookie",'
'}';
