{% from "components/promo-card/macro.njk" import promoCard %}
{% from "components/split-nav/macro.njk" import splitNav with context %}
{% from './helpers.njk' import pgLink, buildLocationList with context %}

{% macro grantResultItem(grant, options) %}
    <div class="u-margin-bottom-s{% if options.wrapperClass %} {{ options.wrapperClass }}{% endif %}" data-score="{{ grant._textScore }}">
        {% set subtitle %}
            {% set mainRecipient = grant.recipientOrganization[0] %}
            Â£{{ grant.amountAwarded | numberWithCommas}} to
            <strong><a href="{{ localify("/funding/search-past-grants-alpha/recipient/" + mainRecipient.id) }}">{{ mainRecipient.name | striptags }}</a></strong>
            on {{ formatDate(grant.awardDate, DATE_FORMATS.short) }}
        {% endset %}
        {% call promoCard({
            "title": grant.title,
            "subtitle": subtitle | safe,
            "trailText": false if options.hideDescription else grant.description,
            "link": {
                "url": localify("/funding/search-past-grants-alpha/grant/" + grant.id),
                "label": "View full details"
            }
        }) %}
            <dl class="o-definition-list o-definition-list--compact">
                {% if grant.beneficiaryLocation and not options.hideLocation %}
                    <dt>Location</dt>
                    <dd>
                        {{ buildLocationList(grant.beneficiaryLocation) }}
                    </dd>
                {% endif %}
                <dt>Grant programme</dt>
                {% for programme in grant.grantProgramme %}
                    <dd><a href="{{ pgLink('programme', programme.title) }}">{{ programme.title }}</a></dd>
                {% endfor %}
                {% if grant.isActive %}
                    <span class="grant-programme is-active-project u-margin-top-s">Active Project</span>
                {% endif %}
            </dl>
        {% endcall %}
    </div>
{% endmacro %}

{% macro grantResultList(grants, options = {}) %}
    {% if grants.length > 0 %}
        {% for grant in grants %}
            {{ grantResultItem(grant, options) }}
        {% endfor %}
        {% if not options.hidePagination %}
            {{ splitNav(pagination.prevLink, pagination.nextLink) }}
        {% endif %}
    {% else %}
        {# @TODO add suggested search results etc #}
        <p>No results</p>
    {% endif %}
{% endmacro %}
