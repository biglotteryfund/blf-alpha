{% from "components/hero.njk" import hero with context %}
{% from "components/breadcrumb-trail/macro.njk" import breadcrumbTrail %}
{% from "components/feedback.njk" import inlineFeedback with context %}
{% from "components/promo-card/macro.njk" import promoCard %}

{% extends "layouts/main.njk" %}

{% block content %}
    <main role="main">
        {{ hero(
            titleText = copy.title,
            image = heroImage,
            accent = pageAccent
        ) }}

        <div class="nudge-up">
            <div class="content-box u-inner-wide-only accent--{{ pageAccent }} a--border-top">
                {{ breadcrumbTrail(breadcrumbs) }}

                <section class="s-prose u-constrained-content-wide">
                    {{ __('funding.pastGrants.introBeta', grantNavLink) | safe }}
                </section>
            </div>

            <form method="get" action="{{ localify('/funding/past-grants/search') }}" class="u-inner-wide-only">
                <div class="grants-searchbar">
                    <label class="ff-label ff-label--append"
                        data-append="{{ copy.search.beta }}"
                        for="search-query-fallback">
                        {{ copy.search.title }}
                    </label>
                    <div class="form-field-addon u-margin-bottom-s">
                        <input
                            class="form-field-addon__input"
                            type="search"
                            id="search-query-fallback"
                            name="q"
                            value="{{ queryParams.q }}"
                        />
                        <input
                            class="form-field-addon__action"
                            type="submit"
                            value="{{ copy.search.submit }}"
                        />
                    </div>
                    <p class="ff-help u-no-margin">
                        {{ copy.search.helpText }}
                    </p>
                </div>
            </form>

            {% if caseStudies and caseStudies.length > 0 %}
                <section id="section-case-studies" class="u-padded">
                    <div class="u-inner">
                        <h3 class="t3 t--underline accent--pink a--text">{{ copy.search.featuredGrants }}</h3>
                        <ul class="flex-grid flex-grid--3up">
                            {% for caseStudy in caseStudies %}
                                <li class="flex-grid__item">
                                    {% set props = {
                                        "title": caseStudy.title,
                                        "subtitle": caseStudy.grantAmount,
                                        "trailText": caseStudy.trailText,
                                        "image": {
                                            "url": caseStudy.thumbnailUrl,
                                            "alt": caseStudy.title
                                        },
                                        "link": {
                                            "label": copy.search.viewGrantDetails,
                                            "labelAria": copy.search.viewGrantDetails,
                                            "url": localify("/funding/past-grants/search/grant/" + caseStudy.grantId)
                                        }
                                    } %}
                                    {{ promoCard(props, tint = true) }}
                                </li>
                            {% endfor %}
                        </ul>
                    </div>
                </section>
            {% endif %}
        </div>
    </main>
{% endblock %}
