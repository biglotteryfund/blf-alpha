{% from "components/breadcrumb-trail/macro.njk" import breadcrumbTrail %}
{% from "components/promo-card/macro.njk" import promoCard %}
{% from "components/split-nav/macro.njk" import splitNav %}

{% set bodyClass = 'has-static-header' %}
{% extends "layouts/main.njk" %}

{% macro newsSection(title, entries, allLink) %}
    <section class="latest-news u-margin-bottom">
        <header class="latest-news__header">
            <h2 class="t3 a--text accent--blue">
                <a class="u-link-minimal" href="{{ allLink }}">
                    {{ title }}
                </a>
            </h2>
        </header>
        <div class="latest-news__content">
            <ul class="flex-grid flex-grid--3up">
                {% for entry in entries | takeItems(3) %}
                    <li class="flex-grid__item">
                        {% set subtitle %}
                            {{ formatDate(entry.postDate.date, DATE_FORMATS.short) }}
                            {% if entry.category -%}
                                {# Only blog posts have categories #}
                                in <a href="{{ localify('/news/blog/?category=' + entry.category.slug) }}">{{ entry.category.title }}</a>
                            {%- endif %}
                        {% endset %}
                        {{ promoCard({
                            "kicker": entry.category.title,
                            "title": entry.trailText or entry.title,
                            "subtitle": subtitle | safe,
                            "trailText": entry.summary,
                            "link": { "url": entry.linkUrl, "label": __('global.misc.readMore') }
                        }) }}
                    </li>
                {% endfor %}
            </ul>
        </div>
        <footer class="latest-news__footer">
            <a class="latest-news__more" href="{{ allLink }}">
                View all {{ title | lower }} &rarr;
            </a>
        </footer>
    </section>
{% endmacro %}

{% block content %}
    {% set pageAccent = 'cyan' %}

    <main role="main" id="content">
        <section class="content-box u-inner-wide-only accent--{{ pageAccent }} a--border-top">
            {{ breadcrumbTrail(breadcrumbs) }}

            <h1 class="t--underline">{{ title }}</h1>

            {# Updates #}
            {{ newsSection(
                title = copy.types.updates.plural,
                entries = groupedEntries.updates,
                allLink = localify('/news/updates')
            )}}


            {# Blog posts #}
            {{ newsSection(
                title = copy.types.blog.plural,
                entries = groupedEntries.blog,
                allLink = localify('/news/blog')
            )}}

            {# Press releases #}
            {{ newsSection(
                title = copy.types['press-releases'].plural,
                entries = groupedEntries.press_releases,
                allLink = localify('/news/press-releases')
            )}}

            {{ splitNav(
                prevLink = {
                    "label": "Previous page",
                    "url": pagination.prevLink
                },
                nextLink = {
                    "label": "Next page",
                    "url": pagination.nextLink
                }
            ) }}

        </section>
    </main>
{% endblock %}
