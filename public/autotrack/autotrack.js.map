{"version":3,"sources":[" [synthetic:util/defineproperty] "," [synthetic:util/global] "," [synthetic:es6/symbol] "," [synthetic:es6/util/arrayfromiterable] "," [synthetic:es6/util/makeiterator] "," [synthetic:es6/util/arrayfromiterator] "," [synthetic:es6/util/inherits] ","../../../../../.nvm/versions/node/v8.6.0/lib/node_modules/autotrack/node_modules/dom-utils/lib/parse-url.js","../../../../../.nvm/versions/node/v8.6.0/lib/node_modules/autotrack/lib/method-chain.js","../../../../../.nvm/versions/node/v8.6.0/lib/node_modules/autotrack/lib/utilities.js","../../../../../.nvm/versions/node/v8.6.0/lib/node_modules/autotrack/lib/plugins/max-scroll-tracker.js","../../../../../.nvm/versions/node/v8.6.0/lib/node_modules/autotrack/lib/event-emitter.js","../../../../../.nvm/versions/node/v8.6.0/lib/node_modules/autotrack/lib/store.js","../../../../../.nvm/versions/node/v8.6.0/lib/node_modules/autotrack/lib/session.js","../../../../../.nvm/versions/node/v8.6.0/lib/node_modules/autotrack/lib/usage.js","../../../../../.nvm/versions/node/v8.6.0/lib/node_modules/autotrack/lib/constants.js","../../../../../.nvm/versions/node/v8.6.0/lib/node_modules/autotrack/lib/provide.js"],"names":["$jscomp.defineProperty","$jscomp.global","$jscomp.initSymbol","$jscomp.Symbol","$jscomp.symbolCounter_","$jscomp.SYMBOL_PREFIX","$jscomp.arrayIterator","$jscomp.initSymbolIterator","$jscomp.iteratorPrototype","DEFAULT_PORT","a","document","createElement","cache","parseUrl","url","location","href","charAt","port","HTTP_PORT","HTTPS_PORT","host","replace","hash","hostname","origin","protocol","pathname","search","instances","constructor","MethodChain","context","methodName","originalMethodReference","isTask","test","get","methodChain","boundMethodChain","wrappedMethod","this.wrappedMethod","lastBoundMethod","length","$jscomp.arrayFromIterable","args","set","remove","overrideMethod","index","indexOf","splice","rebindMethodChain","destroy","method","i","previousMethod","bind","push","getOrCreateMethodChain","filter","h","createFieldsObj","defaultFields","userFields","tracker","hitFilter","originalBuildHitTask","buildHitTask","model","target","event","assign","debounce","fn","timeout","clearTimeout","setTimeout","wait","Object","len","sources","source","key","prototype","hasOwnProperty","call","uuid","b","toString","Math","random","EventEmitter","registry_","emit","forEach","getRegistry_","isListening","browserSupportsLocalStorage","Store","defaults","key_","defaults_","cache_","$jscomp.inherits","getOrCreate","trackingId","namespace","AUTOTRACK_PREFIX","join","window","addEventListener","storageListener","isSupported_","localStorage","setItem","removeItem","err","Store.isSupported_","parse","getItem","newData","JSON","stringify","value","clear","store","oldData","oldValue","newValue","data","Session","timeZone","Session.DEFAULT_TIMEOUT","sendHitTaskOverride","add","methodOverride","dateTimeFormatter","Intl","DateTimeFormat","Store.getOrCreate","defaultProps","hitTime","isExpired","id","getId","sessionData","oldHitTime","currentDate","Date","oldHitDate","MINUTES","datesAreDifferentInTimezone","format","originalMethod","sessionControl","sessionWillStart","sessionWillEnd","plugins","CLEAN_URL_TRACKER","EVENT_TRACKER","IMPRESSION_TRACKER","MEDIA_QUERY_TRACKER","OUTBOUND_FORM_TRACKER","OUTBOUND_LINK_TRACKER","PAGE_VISIBILITY_TRACKER","SOCIAL_WIDGET_TRACKER","URL_CHANGE_TRACKER","MAX_SCROLL_TRACKER","PLUGIN_COUNT","keys","MaxScrollTracker","opts","VERSION","usageHex","parseInt","str","toAdd","plugin","usageBin","substr","defaultOpts","increaseThreshold","sessionTimeout","fieldsObj","pagePath","getPagePath","handleScroll","trackerSetOverride","session","listenForMaxScrollChanges","getMaxScrollPercentageForCurrentPage","html","documentElement","body","scrollPercentage","min","max","round","pageYOffset","pageHeight","offsetHeight","scrollHeight","innerHeight","sessionId","maxScrollPercentage","removeEventListener","stopListeningForMaxScrollChanges","increaseAmount","setMaxScrollPercentageForCurrentPage","transport","eventCategory","eventAction","eventValue","eventLabel","String","nonInteraction","sendMaxScrollEvent","maxScrollMetricIndex","send","field","page","fields","lastPagePath","provide","pluginName","pluginConstructor","gaAlias","GoogleAnalyticsObject","q","gaDevIds","DEV_ID","gaplugins","toUpperCase","slice"],"mappings":"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","file":"","sourcesContent":[null,null,null,null,null,null,null,"const HTTP_PORT = '80';\nconst HTTPS_PORT = '443';\nconst DEFAULT_PORT = RegExp(':(' + HTTP_PORT + '|' + HTTPS_PORT + ')$');\n\n\nconst a = document.createElement('a');\nconst cache = {};\n\n\n/**\n * Parses the given url and returns an object mimicing a `Location` object.\n * @param {string} url The url to parse.\n * @return {!Object} An object with the same properties as a `Location`.\n */\nexport default function parseUrl(url) {\n  // All falsy values (as well as \".\") should map to the current URL.\n  url = (!url || url == '.') ? location.href : url;\n\n  if (cache[url]) return cache[url];\n\n  a.href = url;\n\n  // When parsing file relative paths (e.g. `../index.html`), IE will correctly\n  // resolve the `href` property but will keep the `..` in the `path` property.\n  // It will also not include the `host` or `hostname` properties. Furthermore,\n  // IE will sometimes return no protocol or just a colon, especially for things\n  // like relative protocol URLs (e.g. \"//google.com\").\n  // To workaround all of these issues, we reparse with the full URL from the\n  // `href` property.\n  if (url.charAt(0) == '.' || url.charAt(0) == '/') return parseUrl(a.href);\n\n  // Don't include default ports.\n  let port = (a.port == HTTP_PORT || a.port == HTTPS_PORT) ? '' : a.port;\n\n  // PhantomJS sets the port to \"0\" when using the file: protocol.\n  port = port == '0' ? '' : port;\n\n  // Sometimes IE incorrectly includes a port for default ports\n  // (e.g. `:80` or `:443`) even when no port is specified in the URL.\n  // http://bit.ly/1rQNoMg\n  const host = a.host.replace(DEFAULT_PORT, '');\n\n  // Not all browser support `origin` so we have to build it.\n  const origin = a.origin ? a.origin : a.protocol + '//' + host;\n\n  // Sometimes IE doesn't include the leading slash for pathname.\n  // http://bit.ly/1rQNoMg\n  const pathname = a.pathname.charAt(0) == '/' ? a.pathname : '/' + a.pathname;\n\n  return cache[url] = {\n    hash: a.hash,\n    host: host,\n    hostname: a.hostname,\n    href: a.href,\n    origin: origin,\n    pathname: pathname,\n    port: port,\n    protocol: a.protocol,\n    search: a.search,\n  };\n}\n","/**\n * Copyright 2017 Google Inc. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\n/**\n * @fileoverview\n * The functions exported by this module make it easier (and safer) to override\n * foreign object methods (in a modular way) and respond to or modify their\n * invocation. The primary feature is the ability to override a method without\n * worrying if it's already been overridden somewhere else in the codebase. It\n * also allows for safe restoring of an overridden method by only fully\n * restoring a method once all overrides have been removed.\n */\n\n\nconst instances = [];\n\n\n/**\n * A class that wraps a foreign object method and emit events before and\n * after the original method is called.\n */\nexport default class MethodChain {\n  /**\n   * Adds the passed override method to the list of method chain overrides.\n   * @param {!Object} context The object containing the method to chain.\n   * @param {string} methodName The name of the method on the object.\n   * @param {!Function} methodOverride The override method to add.\n   */\n  static add(context, methodName, methodOverride) {\n    getOrCreateMethodChain(context, methodName).add(methodOverride);\n  }\n\n  /**\n   * Removes a method chain added via `add()`. If the override is the\n   * only override added, the original method is restored.\n   * @param {!Object} context The object containing the method to unchain.\n   * @param {string} methodName The name of the method on the object.\n   * @param {!Function} methodOverride The override method to remove.\n   */\n  static remove(context, methodName, methodOverride) {\n    getOrCreateMethodChain(context, methodName).remove(methodOverride);\n  }\n\n  /**\n   * Wraps a foreign object method and overrides it. Also stores a reference\n   * to the original method so it can be restored later.\n   * @param {!Object} context The object containing the method.\n   * @param {string} methodName The name of the method on the object.\n   */\n  constructor(context, methodName) {\n    this.context = context;\n    this.methodName = methodName;\n    this.isTask = /Task$/.test(methodName);\n\n    this.originalMethodReference = this.isTask ?\n        context.get(methodName) : context[methodName];\n\n    this.methodChain = [];\n    this.boundMethodChain = [];\n\n    // Wraps the original method.\n    this.wrappedMethod = (...args) => {\n      const lastBoundMethod =\n          this.boundMethodChain[this.boundMethodChain.length - 1];\n\n      return lastBoundMethod(...args);\n    };\n\n    // Override original method with the wrapped one.\n    if (this.isTask) {\n      context.set(methodName, this.wrappedMethod);\n    } else {\n      context[methodName] = this.wrappedMethod;\n    }\n  }\n\n  /**\n   * Adds a method to the method chain.\n   * @param {!Function} overrideMethod The override method to add.\n   */\n  add(overrideMethod) {\n    this.methodChain.push(overrideMethod);\n    this.rebindMethodChain();\n  }\n\n  /**\n   * Removes a method from the method chain and restores the prior order.\n   * @param {!Function} overrideMethod The override method to remove.\n   */\n  remove(overrideMethod) {\n    const index = this.methodChain.indexOf(overrideMethod);\n    if (index > -1) {\n      this.methodChain.splice(index, 1);\n      if (this.methodChain.length > 0) {\n        this.rebindMethodChain();\n      } else {\n        this.destroy();\n      }\n    }\n  }\n\n  /**\n   * Loops through the method chain array and recreates the bound method\n   * chain array. This is necessary any time a method is added or removed\n   * to ensure proper original method context and order.\n   */\n  rebindMethodChain() {\n    this.boundMethodChain = [];\n    for (let method, i = 0; method = this.methodChain[i]; i++) {\n      const previousMethod = this.boundMethodChain[i - 1] ||\n          this.originalMethodReference.bind(this.context);\n      this.boundMethodChain.push(method(previousMethod));\n    }\n  }\n\n  /**\n   * Calls super and destroys the instance if no registered handlers remain.\n   */\n  destroy() {\n    const index = instances.indexOf(this);\n    if (index > -1) {\n      instances.splice(index, 1);\n      if (this.isTask) {\n        this.context.set(this.methodName, this.originalMethodReference);\n      } else {\n        this.context[this.methodName] = this.originalMethodReference;\n      }\n    }\n  }\n}\n\n\n/**\n * Gets a MethodChain instance for the passed object and method. If the method\n * has already been wrapped via an existing MethodChain instance, that\n * instance is returned.\n * @param {!Object} context The object containing the method.\n * @param {string} methodName The name of the method on the object.\n * @return {!MethodChain}\n */\nfunction getOrCreateMethodChain(context, methodName) {\n  let methodChain = instances\n      .filter((h) => h.context == context && h.methodName == methodName)[0];\n\n  if (!methodChain) {\n    methodChain = new MethodChain(context, methodName);\n    instances.push(methodChain);\n  }\n  return methodChain;\n}\n","/**\n * Copyright 2016 Google Inc. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\nimport {getAttributes} from 'dom-utils';\nimport MethodChain from './method-chain';\n\n\n/**\n * Accepts default and user override fields and an optional tracker, hit\n * filter, and target element and returns a single object that can be used in\n * `ga('send', ...)` commands.\n * @param {FieldsObj} defaultFields The default fields to return.\n * @param {FieldsObj} userFields Fields set by the user to override the\n *     defaults.\n * @param {Tracker=} tracker The tracker object to apply the hit filter to.\n * @param {Function=} hitFilter A filter function that gets\n *     called with the tracker model right before the `buildHitTask`. It can\n *     be used to modify the model for the current hit only.\n * @param {Element=} target If the hit originated from an interaction\n *     with a DOM element, hitFilter is invoked with that element as the\n *     second argument.\n * @param {(Event|TwttrEvent)=} event If the hit originated via a DOM event,\n *     hitFilter is invoked with that event as the third argument.\n * @return {!FieldsObj} The final fields object.\n */\nexport function createFieldsObj(\n    defaultFields, userFields, tracker = undefined,\n    hitFilter = undefined, target = undefined, event = undefined) {\n  if (typeof hitFilter == 'function') {\n    const originalBuildHitTask = tracker.get('buildHitTask');\n    return {\n      buildHitTask: (/** @type {!Model} */ model) => {\n        model.set(defaultFields, null, true);\n        model.set(userFields, null, true);\n        hitFilter(model, target, event);\n        originalBuildHitTask(model);\n      },\n    };\n  } else {\n    return assign({}, defaultFields, userFields);\n  }\n}\n\n\n/**\n * Retrieves the attributes from an DOM element and returns a fields object\n * for all attributes matching the passed prefix string.\n * @param {Element} element The DOM element to get attributes from.\n * @param {string} prefix An attribute prefix. Only the attributes matching\n *     the prefix will be returned on the fields object.\n * @return {FieldsObj} An object of analytics.js fields and values\n */\nexport function getAttributeFields(element, prefix) {\n  const attributes = getAttributes(element);\n  const attributeFields = {};\n\n  Object.keys(attributes).forEach(function(attribute) {\n    // The `on` prefix is used for event handling but isn't a field.\n    if (attribute.indexOf(prefix) === 0 && attribute != prefix + 'on') {\n      let value = attributes[attribute];\n\n      // Detects Boolean value strings.\n      if (value == 'true') value = true;\n      if (value == 'false') value = false;\n\n      const field = camelCase(attribute.slice(prefix.length));\n      attributeFields[field] = value;\n    }\n  });\n\n  return attributeFields;\n}\n\n\n/**\n * Accepts a function to be invoked once the DOM is ready. If the DOM is\n * already ready, the callback is invoked immediately.\n * @param {!Function} callback The ready callback.\n */\nexport function domReady(callback) {\n  if (document.readyState == 'loading') {\n    document.addEventListener('DOMContentLoaded', function fn() {\n      document.removeEventListener('DOMContentLoaded', fn);\n      callback();\n    });\n  } else {\n    callback();\n  }\n}\n\n\n/**\n * Returns a function, that, as long as it continues to be called, will not\n * actually run. The function will only run after it stops being called for\n * `wait` milliseconds.\n * @param {!Function} fn The function to debounce.\n * @param {number} wait The debounce wait timeout in ms.\n * @return {!Function} The debounced function.\n */\nexport function debounce(fn, wait) {\n  let timeout;\n  return function(...args) {\n    clearTimeout(timeout);\n    timeout = setTimeout(() => fn(...args), wait);\n  };\n}\n\n\n/**\n * Accepts a function and returns a wrapped version of the function that is\n * expected to be called elsewhere in the system. If it's not called\n * elsewhere after the timeout period, it's called regardless. The wrapper\n * function also prevents the callback from being called more than once.\n * @param {!Function} callback The function to call.\n * @param {number=} wait How many milliseconds to wait before invoking\n *     the callback.\n * @return {!Function} The wrapped version of the passed function.\n */\nexport function withTimeout(callback, wait = 2000) {\n  let called = false;\n  const fn = function() {\n    if (!called) {\n      called = true;\n      callback();\n    }\n  };\n  setTimeout(fn, wait);\n  return fn;\n}\n\n// Maps trackers to queue by tracking ID.\nconst queueMap = {};\n\n/**\n * Queues a function for execution in the next call stack, or immediately\n * before any send commands are executed on the tracker. This allows\n * autotrack plugins to defer running commands until after all other plugins\n * are required but before any other hits are sent.\n * @param {!Tracker} tracker\n * @param {!Function} fn\n */\nexport function deferUntilPluginsLoaded(tracker, fn) {\n  const trackingId = tracker.get('trackingId');\n  const ref = queueMap[trackingId] = queueMap[trackingId] || {};\n\n  const processQueue = () => {\n    clearTimeout(ref.timeout);\n    if (ref.send) {\n      MethodChain.remove(tracker, 'send', ref.send);\n    }\n    delete queueMap[trackingId];\n\n    ref.queue.forEach((fn) => fn());\n  };\n\n  clearTimeout(ref.timeout);\n  ref.timeout = setTimeout(processQueue, 0);\n  ref.queue = ref.queue || [];\n  ref.queue.push(fn);\n\n  if (!ref.send) {\n    ref.send = (originalMethod) => {\n      return (...args) => {\n        processQueue();\n        originalMethod(...args);\n      };\n    };\n    MethodChain.add(tracker, 'send', ref.send);\n  }\n}\n\n\n/**\n * A small shim of Object.assign that aims for brevity over spec-compliant\n * handling all the edge cases.\n * @param {!Object} target The target object to assign to.\n * @param {...?Object} sources Additional objects who properties should be\n *     assigned to target. Non-objects are converted to objects.\n * @return {!Object} The modified target object.\n */\nexport const assign = Object.assign || function(target, ...sources) {\n  for (let i = 0, len = sources.length; i < len; i++) {\n    const source = Object(sources[i]);\n    for (let key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n  return target;\n};\n\n\n/**\n * Accepts a string containing hyphen or underscore word separators and\n * converts it to camelCase.\n * @param {string} str The string to camelCase.\n * @return {string} The camelCased version of the string.\n */\nexport function camelCase(str) {\n  return str.replace(/[\\-\\_]+(\\w?)/g, function(match, p1) {\n    return p1.toUpperCase();\n  });\n}\n\n\n/**\n * Capitalizes the first letter of a string.\n * @param {string} str The input string.\n * @return {string} The capitalized string\n */\nexport function capitalize(str) {\n  return str.charAt(0).toUpperCase() + str.slice(1);\n}\n\n\n/**\n * Indicates whether the passed variable is a JavaScript object.\n * @param {*} value The input variable to test.\n * @return {boolean} Whether or not the test is an object.\n */\nexport function isObject(value) {\n  return typeof value == 'object' && value !== null;\n}\n\n\n/**\n * Accepts a value that may or may not be an array. If it is not an array,\n * it is returned as the first item in a single-item array.\n * @param {*} value The value to convert to an array if it is not.\n * @return {!Array} The array-ified value.\n */\nexport function toArray(value) {\n  return Array.isArray(value) ? value : [value];\n}\n\n\n/**\n * @return {number} The current date timestamp\n */\nexport function now() {\n  return +new Date();\n}\n\n\n/*eslint-disable */\n// https://gist.github.com/jed/982883\n/** @param {?=} a */\nexport const uuid = function b(a){return a?(a^Math.random()*16>>a/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,b)};\n/*eslint-enable */\n","/**\n * Copyright 2017 Google Inc. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\nimport {parseUrl} from 'dom-utils';\nimport MethodChain from '../method-chain';\nimport provide from '../provide';\nimport Session from '../session';\nimport Store from '../store';\nimport {plugins, trackUsage} from '../usage';\nimport {assign, createFieldsObj, debounce, isObject} from '../utilities';\n\n\n/**\n * Class for the `maxScrollQueryTracker` analytics.js plugin.\n * @implements {MaxScrollTrackerPublicInterface}\n */\nclass MaxScrollTracker {\n  /**\n   * Registers outbound link tracking on tracker object.\n   * @param {!Tracker} tracker Passed internally by analytics.js\n   * @param {?Object} opts Passed by the require command.\n   */\n  constructor(tracker, opts) {\n    trackUsage(tracker, plugins.MAX_SCROLL_TRACKER);\n\n    // Feature detects to prevent errors in unsupporting browsers.\n    if (!window.addEventListener) return;\n\n    /** @type {MaxScrollTrackerOpts} */\n    const defaultOpts = {\n      increaseThreshold: 20,\n      sessionTimeout: Session.DEFAULT_TIMEOUT,\n      // timeZone: undefined,\n      // maxScrollMetricIndex: undefined,\n      fieldsObj: {},\n      // hitFilter: undefined\n    };\n\n    this.opts = /** @type {MaxScrollTrackerOpts} */ (\n        assign(defaultOpts, opts));\n\n    this.tracker = tracker;\n    this.pagePath = this.getPagePath();\n\n    // Binds methods to `this`.\n    this.handleScroll = debounce(this.handleScroll.bind(this), 500);\n    this.trackerSetOverride = this.trackerSetOverride.bind(this);\n\n    // Creates the store and binds storage change events.\n    this.store = Store.getOrCreate(\n        tracker.get('trackingId'), 'plugins/max-scroll-tracker');\n\n    // Creates the session and binds session events.\n    this.session = Session.getOrCreate(\n        tracker, this.opts.sessionTimeout, this.opts.timeZone);\n\n    // Override the built-in tracker.set method to watch for changes.\n    MethodChain.add(tracker, 'set', this.trackerSetOverride);\n\n    this.listenForMaxScrollChanges();\n  }\n\n\n  /**\n   * Adds a scroll event listener if the max scroll percentage for the\n   * current page isn't already at 100%.\n   */\n  listenForMaxScrollChanges() {\n    const maxScrollPercentage = this.getMaxScrollPercentageForCurrentPage();\n    if (maxScrollPercentage < 100) {\n      window.addEventListener('scroll', this.handleScroll);\n    }\n  }\n\n\n  /**\n   * Removes an added scroll listener.\n   */\n  stopListeningForMaxScrollChanges() {\n    window.removeEventListener('scroll', this.handleScroll);\n  }\n\n\n  /**\n   * Handles the scroll event. If the current scroll percentage is greater\n   * that the stored scroll event by at least the specified increase threshold,\n   * send an event with the increase amount.\n   */\n  handleScroll() {\n    const pageHeight = getPageHeight();\n    const scrollPos = window.pageYOffset; // scrollY isn't supported in IE.\n    const windowHeight = window.innerHeight;\n\n    // Ensure scrollPercentage is an integer between 0 and 100.\n    const scrollPercentage = Math.min(100, Math.max(0,\n        Math.round(100 * (scrollPos / (pageHeight - windowHeight)))));\n\n    // If the max scroll data gets out of the sync with the session data\n    // (for whatever reason), clear it.\n    const sessionId = this.session.getId();\n    if (sessionId != this.store.get().sessionId) {\n      this.store.clear();\n      this.store.set({sessionId});\n    }\n\n    // If the session has expired, clear the stored data and don't send any\n    // events (since they'd start a new session). Note: this check is needed,\n    // in addition to the above check, to handle cases where the session IDs\n    // got out of sync, but the session didn't expire.\n    if (this.session.isExpired(this.store.get().sessionId)) {\n      this.store.clear();\n    } else {\n      const maxScrollPercentage = this.getMaxScrollPercentageForCurrentPage();\n\n      if (scrollPercentage > maxScrollPercentage) {\n        if (scrollPercentage == 100 || maxScrollPercentage == 100) {\n          this.stopListeningForMaxScrollChanges();\n        }\n        const increaseAmount = scrollPercentage - maxScrollPercentage;\n        if (scrollPercentage == 100 ||\n            increaseAmount >= this.opts.increaseThreshold) {\n          this.setMaxScrollPercentageForCurrentPage(scrollPercentage);\n          this.sendMaxScrollEvent(increaseAmount, scrollPercentage);\n        }\n      }\n    }\n  }\n\n  /**\n   * Detects changes to the tracker object and triggers an update if the page\n   * field has changed.\n   * @param {function((Object|string), (string|undefined))} originalMethod\n   *     A reference to the overridden method.\n   * @return {function((Object|string), (string|undefined))}\n   */\n  trackerSetOverride(originalMethod) {\n    return (field, value) => {\n      originalMethod(field, value);\n\n      /** @type {!FieldsObj} */\n      const fields = isObject(field) ? field : {[field]: value};\n      if (fields.page) {\n        const lastPagePath = this.pagePath;\n        this.pagePath = this.getPagePath();\n\n        if (this.pagePath != lastPagePath) {\n          // Since event listeners for the same function are never added twice,\n          // we don't need to worry about whether we're already listening. We\n          // can just add the event listener again.\n          this.listenForMaxScrollChanges();\n        }\n      }\n    };\n  }\n\n  /**\n   * Sends an event for the increased max scroll percentage amount.\n   * @param {number} increaseAmount\n   * @param {number} scrollPercentage\n   */\n  sendMaxScrollEvent(increaseAmount, scrollPercentage) {\n    /** @type {FieldsObj} */\n    const defaultFields = {\n      transport: 'beacon',\n      eventCategory: 'Max Scroll',\n      eventAction: 'increase',\n      eventValue: increaseAmount,\n      eventLabel: String(scrollPercentage),\n      nonInteraction: true,\n    };\n\n    // If a custom metric was specified, set it equal to the event value.\n    if (this.opts.maxScrollMetricIndex) {\n      defaultFields['metric' + this.opts.maxScrollMetricIndex] = increaseAmount;\n    }\n\n    this.tracker.send('event',\n        createFieldsObj(defaultFields, this.opts.fieldsObj,\n            this.tracker, this.opts.hitFilter));\n  }\n\n  /**\n   * Stores the current max scroll percentage for the current page.\n   * @param {number} maxScrollPercentage\n   */\n  setMaxScrollPercentageForCurrentPage(maxScrollPercentage) {\n    this.store.set({\n      [this.pagePath]: maxScrollPercentage,\n      sessionId: this.session.getId(),\n    });\n  }\n\n  /**\n   * Gets the stored max scroll percentage for the current page.\n   * @return {number}\n   */\n  getMaxScrollPercentageForCurrentPage() {\n    return this.store.get()[this.pagePath] || 0;\n  }\n\n  /**\n   * Gets the page path from the tracker object.\n   * @return {number}\n   */\n  getPagePath() {\n    const url = parseUrl(\n        this.tracker.get('page') || this.tracker.get('location'));\n    return url.pathname + url.search;\n  }\n\n  /**\n   * Removes all event listeners and restores overridden methods.\n   */\n  remove() {\n    this.session.destroy();\n    this.stopListeningForMaxScrollChanges();\n    MethodChain.remove(this.tracker, 'set', this.trackerSetOverride);\n  }\n}\n\n\nprovide('maxScrollTracker', MaxScrollTracker);\n\n\n/**\n * Gets the maximum height of the page including scrollable area.\n * @return {number}\n */\nfunction getPageHeight() {\n  const html = document.documentElement;\n  const body = document.body;\n  return Math.max(html.offsetHeight, html.scrollHeight,\n      body.offsetHeight, body.scrollHeight);\n}\n","/**\n * Copyright 2016 Google Inc. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\n/**\n * An simple reimplementation of the native Node.js EventEmitter class.\n * The goal of this implementation is to be as small as possible.\n */\nexport default class EventEmitter {\n  /**\n   * Creates the event registry.\n   */\n  constructor() {\n    this.registry_ = {};\n  }\n\n  /**\n   * Adds a handler function to the registry for the passed event.\n   * @param {string} event The event name.\n   * @param {!Function} fn The handler to be invoked when the passed\n   *     event is emitted.\n   */\n  on(event, fn) {\n    this.getRegistry_(event).push(fn);\n  }\n\n  /**\n   * Removes a handler function from the registry for the passed event.\n   * @param {string=} event The event name.\n   * @param {Function=} fn The handler to be removed.\n   */\n  off(event = undefined, fn = undefined) {\n    if (event && fn) {\n      const eventRegistry = this.getRegistry_(event);\n      const handlerIndex = eventRegistry.indexOf(fn);\n      if (handlerIndex > -1) {\n        eventRegistry.splice(handlerIndex, 1);\n      }\n    } else {\n      this.registry_ = {};\n    }\n  }\n\n  /**\n   * Runs all registered handlers for the passed event with the optional args.\n   * @param {string} event The event name.\n   * @param {...*} args The arguments to be passed to the handler.\n   */\n  emit(event, ...args) {\n    this.getRegistry_(event).forEach((fn) => fn(...args));\n  }\n\n  /**\n   * Returns the total number of event handlers currently registered.\n   * @return {number}\n   */\n  getEventCount() {\n    let eventCount = 0;\n    Object.keys(this.registry_).forEach((event) => {\n      eventCount += this.getRegistry_(event).length;\n    });\n    return eventCount;\n  }\n\n  /**\n   * Returns an array of handlers associated with the passed event name.\n   * If no handlers have been registered, an empty array is returned.\n   * @private\n   * @param {string} event The event name.\n   * @return {!Array} An array of handler functions.\n   */\n  getRegistry_(event) {\n    return this.registry_[event] = (this.registry_[event] || []);\n  }\n}\n","/**\n * Copyright 2016 Google Inc. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\nimport EventEmitter from './event-emitter';\nimport {assign} from './utilities';\n\n\nconst AUTOTRACK_PREFIX = 'autotrack';\nconst instances = {};\nlet isListening = false;\n\n\n/** @type {boolean|undefined} */\nlet browserSupportsLocalStorage;\n\n\n/**\n * A storage object to simplify interacting with localStorage.\n */\nexport default class Store extends EventEmitter {\n  /**\n   * Gets an existing instance for the passed arguements or creates a new\n   * instance if one doesn't exist.\n   * @param {string} trackingId The tracking ID for the GA property.\n   * @param {string} namespace A namespace unique to this store.\n   * @param {Object=} defaults An optional object of key/value defaults.\n   * @return {Store} The Store instance.\n   */\n  static getOrCreate(trackingId, namespace, defaults) {\n    const key = [AUTOTRACK_PREFIX, trackingId, namespace].join(':');\n\n    // Don't create multiple instances for the same tracking Id and namespace.\n    if (!instances[key]) {\n      instances[key] = new Store(key, defaults);\n      if (!isListening) initStorageListener();\n    }\n    return instances[key];\n  }\n\n  /**\n   * Returns true if the browser supports and can successfully write to\n   * localStorage. The results is cached so this method can be invoked many\n   * times with no extra performance cost.\n   * @private\n   * @return {boolean}\n   */\n  static isSupported_() {\n    if (browserSupportsLocalStorage != null) {\n      return browserSupportsLocalStorage;\n    }\n\n    try {\n      window.localStorage.setItem(AUTOTRACK_PREFIX, AUTOTRACK_PREFIX);\n      window.localStorage.removeItem(AUTOTRACK_PREFIX);\n      browserSupportsLocalStorage = true;\n    } catch (err) {\n      browserSupportsLocalStorage = false;\n    }\n    return browserSupportsLocalStorage;\n  }\n\n  /**\n   * Wraps the native localStorage method for each stubbing in tests.\n   * @private\n   * @param {string} key The store key.\n   * @return {string|null} The stored value.\n   */\n  static get_(key) {\n    return window.localStorage.getItem(key);\n  }\n\n  /**\n   * Wraps the native localStorage method for each stubbing in tests.\n   * @private\n   * @param {string} key The store key.\n   * @param {string} value The value to store.\n   */\n  static set_(key, value) {\n    window.localStorage.setItem(key, value);\n  }\n\n  /**\n   * Wraps the native localStorage method for each stubbing in tests.\n   * @private\n   * @param {string} key The store key.\n   */\n  static clear_(key) {\n    window.localStorage.removeItem(key);\n  }\n\n  /**\n   * @param {string} key A key unique to this store.\n   * @param {Object=} defaults An optional object of key/value defaults.\n   */\n  constructor(key, defaults = {}) {\n    super();\n    this.key_ = key;\n    this.defaults_ = defaults;\n\n    /** @type {?Object} */\n    this.cache_ = null; // Will be set after the first get.\n  }\n\n  /**\n   * Gets the data stored in localStorage for this store. If the cache is\n   * already populated, return it as is (since it's always kept up-to-date\n   * and in sync with activity in other windows via the `storage` event).\n   * TODO(philipwalton): Implement schema migrations if/when a new\n   * schema version is introduced.\n   * @return {!Object} The stored data merged with the defaults.\n   */\n  get() {\n    if (this.cache_) {\n      return this.cache_;\n    } else {\n      if (Store.isSupported_()) {\n        try {\n          this.cache_ = parse(Store.get_(this.key_));\n        } catch(err) {\n          // Do nothing.\n        }\n      }\n      return this.cache_ = assign({}, this.defaults_, this.cache_);\n    }\n  }\n\n  /**\n   * Saves the passed data object to localStorage,\n   * merging it with the existing data.\n   * @param {Object} newData The data to save.\n   */\n  set(newData) {\n    this.cache_ = assign({}, this.defaults_, this.cache_, newData);\n\n    if (Store.isSupported_()) {\n      try {\n        Store.set_(this.key_, JSON.stringify(this.cache_));\n      } catch(err) {\n        // Do nothing.\n      }\n    }\n  }\n\n  /**\n   * Clears the data in localStorage for the current store.\n   */\n  clear() {\n    this.cache_ = {};\n    if (Store.isSupported_()) {\n      try {\n        Store.clear_(this.key_);\n      } catch(err) {\n        // Do nothing.\n      }\n    }\n  }\n\n  /**\n   * Removes the store instance for the global instances map. If this is the\n   * last store instance, the storage listener is also removed.\n   * Note: this does not erase the stored data. Use `clear()` for that.\n   */\n  destroy() {\n    delete instances[this.key_];\n    if (!Object.keys(instances).length) {\n      removeStorageListener();\n    }\n  }\n}\n\n\n/**\n * Adds a single storage event listener and flips the global `isListening`\n * flag so multiple events aren't added.\n */\nfunction initStorageListener() {\n  window.addEventListener('storage', storageListener);\n  isListening = true;\n}\n\n\n/**\n * Removes the storage event listener and flips the global `isListening`\n * flag so it can be re-added later.\n */\nfunction removeStorageListener() {\n  window.removeEventListener('storage', storageListener);\n  isListening = false;\n}\n\n\n/**\n * The global storage event listener.\n * @param {!Event} event The DOM event.\n */\nfunction storageListener(event) {\n  const store = instances[event.key];\n  if (store) {\n    const oldData = assign({}, store.defaults_, parse(event.oldValue));\n    const newData = assign({}, store.defaults_, parse(event.newValue));\n\n    store.cache_ = newData;\n    store.emit('externalSet', newData, oldData);\n  }\n}\n\n\n/**\n * Parses a source string as JSON\n * @param {string|null} source\n * @return {!Object} The JSON object.\n */\nfunction parse(source) {\n  let data = {};\n  if (source) {\n    try {\n      data = /** @type {!Object} */ (JSON.parse(source));\n    } catch(err) {\n      // Do nothing.\n    }\n  }\n  return data;\n}\n","/**\n * Copyright 2016 Google Inc. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\nimport MethodChain from './method-chain';\nimport Store from './store';\nimport {now, uuid} from './utilities';\n\n\nconst SECONDS = 1000;\nconst MINUTES = 60 * SECONDS;\n\n\nconst instances = {};\n\n\n/**\n * A session management class that helps track session boundaries\n * across multiple open tabs/windows.\n */\nexport default class Session {\n  /**\n   * Gets an existing instance for the passed arguments or creates a new\n   * instance if one doesn't exist.\n   * @param {!Tracker} tracker An analytics.js tracker object.\n   * @param {number} timeout The session timeout (in minutes). This value\n   *     should match what's set in the \"Session settings\" section of the\n   *     Google Analytics admin.\n   * @param {string=} timeZone The optional IANA time zone of the view. This\n   *     value should match what's set in the \"View settings\" section of the\n   *     Google Analytics admin. (Note: this assumes all views for the property\n   *     use the same time zone. If that's not true, it's better not to use\n   *     this feature).\n   * @return {Session} The Session instance.\n   */\n  static getOrCreate(tracker, timeout, timeZone) {\n    // Don't create multiple instances for the same property.\n    const trackingId = tracker.get('trackingId');\n    if (instances[trackingId]) {\n      return instances[trackingId];\n    } else {\n      return instances[trackingId] = new Session(tracker, timeout, timeZone);\n    }\n  }\n\n  /**\n   * @param {!Tracker} tracker An analytics.js tracker object.\n   * @param {number} timeout The session timeout (in minutes). This value\n   *     should match what's set in the \"Session settings\" section of the\n   *     Google Analytics admin.\n   * @param {string=} timeZone The optional IANA time zone of the view. This\n   *     value should match what's set in the \"View settings\" section of the\n   *     Google Analytics admin. (Note: this assumes all views for the property\n   *     use the same time zone. If that's not true, it's better not to use\n   *     this feature).\n   */\n  constructor(tracker, timeout, timeZone) {\n    this.tracker = tracker;\n    this.timeout = timeout || Session.DEFAULT_TIMEOUT;\n    this.timeZone = timeZone;\n\n    // Binds methods.\n    this.sendHitTaskOverride = this.sendHitTaskOverride.bind(this);\n\n    // Overrides into the trackers sendHitTask method.\n    MethodChain.add(tracker, 'sendHitTask', this.sendHitTaskOverride);\n\n    // Some browser doesn't support various features of the\n    // `Intl.DateTimeFormat` API, so we have to try/catch it. Consequently,\n    // this allows us to assume the presence of `this.dateTimeFormatter` means\n    // it works in the current browser.\n    try {\n      this.dateTimeFormatter =\n          new Intl.DateTimeFormat('en-US', {timeZone: this.timeZone});\n    } catch(err) {\n      // Do nothing.\n    }\n\n    /** @type {SessionStoreData} */\n    const defaultProps = {\n      hitTime: 0,\n      isExpired: false,\n    };\n    this.store = Store.getOrCreate(\n        tracker.get('trackingId'), 'session', defaultProps);\n\n    // Ensure the session has an ID.\n    if (!this.store.get().id) {\n      this.store.set(/** @type {SessionStoreData} */ ({id: uuid()}));\n    }\n  }\n\n  /**\n   * Returns the ID of the current session.\n   * @return {string}\n   */\n  getId() {\n    return this.store.get().id;\n  }\n\n  /**\n   * Accepts a session ID and returns true if the specified session has\n   * evidentially expired. A session can expire for two reasons:\n   *   - More than 30 minutes has elapsed since the previous hit\n   *     was sent (The 30 minutes number is the Google Analytics default, but\n   *     it can be modified in GA admin \"Session settings\").\n   *   - A new day has started since the previous hit, in the\n   *     specified time zone (should correspond to the time zone of the\n   *     property's views).\n   *\n   * Note: since real session boundaries are determined at processing time,\n   * this is just a best guess rather than a source of truth.\n   *\n   * @param {string} id The ID of a session to check for expiry.\n   * @return {boolean} True if the session has not exp\n   */\n  isExpired(id = this.getId()) {\n    // If a session ID is passed and it doesn't match the current ID,\n    // assume it's from an expired session. If no ID is passed, assume the ID\n    // of the current session.\n    if (id != this.getId()) return true;\n\n    /** @type {SessionStoreData} */\n    const sessionData = this.store.get();\n\n    // `isExpired` will be `true` if the sessionControl field was set to\n    // 'end' on the previous hit.\n    if (sessionData.isExpired) return true;\n\n    const oldHitTime = sessionData.hitTime;\n\n    // Only consider a session expired if previous hit time data exists, and\n    // the previous hit time is greater than that session timeout period or\n    // the hits occurred on different days in the session timezone.\n    if (oldHitTime) {\n      const currentDate = new Date();\n      const oldHitDate = new Date(oldHitTime);\n      if (currentDate - oldHitDate > (this.timeout * MINUTES) ||\n          this.datesAreDifferentInTimezone(currentDate, oldHitDate)) {\n        return true;\n      }\n    }\n\n    // For all other cases return false.\n    return false;\n  }\n\n  /**\n   * Returns true if (and only if) the timezone date formatting is supported\n   * in the current browser and if the two dates are definitively not the\n   * same date in the session timezone. Anything short of this returns false.\n   * @param {!Date} d1\n   * @param {!Date} d2\n   * @return {boolean}\n   */\n  datesAreDifferentInTimezone(d1, d2) {\n    if (!this.dateTimeFormatter) {\n      return false;\n    } else {\n      return this.dateTimeFormatter.format(d1)\n          != this.dateTimeFormatter.format(d2);\n    }\n  }\n\n  /**\n   * Keeps track of when the previous hit was sent to determine if a session\n   * has expired. Also inspects the `sessionControl` field to handles\n   * expiration accordingly.\n   * @param {function(!Model)} originalMethod A reference to the overridden\n   *     method.\n   * @return {function(!Model)}\n   */\n  sendHitTaskOverride(originalMethod) {\n    return (model) => {\n      originalMethod(model);\n\n      const sessionControl = model.get('sessionControl');\n      const sessionWillStart = sessionControl == 'start' || this.isExpired();\n      const sessionWillEnd = sessionControl == 'end';\n\n      /** @type {SessionStoreData} */\n      const sessionData = this.store.get();\n      sessionData.hitTime = now();\n      if (sessionWillStart) {\n        sessionData.isExpired = false;\n        sessionData.id = uuid();\n      }\n      if (sessionWillEnd) {\n        sessionData.isExpired = true;\n      }\n      this.store.set(sessionData);\n    };\n  }\n\n  /**\n   * Restores the tracker's original `sendHitTask` to the state before\n   * session control was initialized and removes this instance from the global\n   * store.\n   */\n  destroy() {\n    MethodChain.remove(this.tracker, 'sendHitTask', this.sendHitTaskOverride);\n    this.store.destroy();\n    delete instances[this.tracker.get('trackingId')];\n  }\n}\n\n\nSession.DEFAULT_TIMEOUT = 30; // minutes\n","/**\n * Copyright 2016 Google Inc. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\nimport {USAGE_PARAM, VERSION, VERSION_PARAM} from './constants';\n\n\nexport const plugins = {\n  CLEAN_URL_TRACKER: 1,\n  EVENT_TRACKER: 2,\n  IMPRESSION_TRACKER: 3,\n  MEDIA_QUERY_TRACKER: 4,\n  OUTBOUND_FORM_TRACKER: 5,\n  OUTBOUND_LINK_TRACKER: 6,\n  PAGE_VISIBILITY_TRACKER: 7,\n  SOCIAL_WIDGET_TRACKER: 8,\n  URL_CHANGE_TRACKER: 9,\n  MAX_SCROLL_TRACKER: 10,\n};\n\n\nconst PLUGIN_COUNT = Object.keys(plugins).length;\n\n\n/**\n * Tracks the usage of the passed plugin by encoding a value into a usage\n * string sent with all hits for the passed tracker.\n * @param {!Tracker} tracker The analytics.js tracker object.\n * @param {number} plugin The plugin enum.\n */\nexport function trackUsage(tracker, plugin) {\n  trackVersion(tracker);\n  trackPlugin(tracker, plugin);\n}\n\n\n/**\n * Converts a hexadecimal string to a binary string.\n * @param {string} hex A hexadecimal numeric string.\n * @return {string} a binary numeric string.\n */\nfunction convertHexToBin(hex) {\n  return parseInt(hex || '0', 16).toString(2);\n}\n\n\n/**\n * Converts a binary string to a hexadecimal string.\n * @param {string} bin A binary numeric string.\n * @return {string} a hexadecimal numeric string.\n */\nfunction convertBinToHex(bin) {\n  return parseInt(bin || '0', 2).toString(16);\n}\n\n\n/**\n * Adds leading zeros to a string if it's less than a minimum length.\n * @param {string} str A string to pad.\n * @param {number} len The minimum length of the string\n * @return {string} The padded string.\n */\nfunction padZeros(str, len) {\n  if (str.length < len) {\n    let toAdd = len - str.length;\n    while (toAdd) {\n      str = '0' + str;\n      toAdd--;\n    }\n  }\n  return str;\n}\n\n\n/**\n * Accepts a binary numeric string and flips the digit from 0 to 1 at the\n * specified index.\n * @param {string} str The binary numeric string.\n * @param {number} index The index to flip the bit.\n * @return {string} The new binary string with the bit flipped on\n */\nfunction flipBitOn(str, index) {\n  return str.substr(0, index) + 1 + str.substr(index + 1);\n}\n\n\n/**\n * Accepts a tracker and a plugin index and flips the bit at the specified\n * index on the tracker's usage parameter.\n * @param {Object} tracker An analytics.js tracker.\n * @param {number} pluginIndex The index of the plugin in the global list.\n */\nfunction trackPlugin(tracker, pluginIndex) {\n  const usageHex = tracker.get('&' + USAGE_PARAM);\n  let usageBin = padZeros(convertHexToBin(usageHex), PLUGIN_COUNT);\n\n  // Flip the bit of the plugin being tracked.\n  usageBin = flipBitOn(usageBin, PLUGIN_COUNT - pluginIndex);\n\n  // Stores the modified usage string back on the tracker.\n  tracker.set('&' + USAGE_PARAM, convertBinToHex(usageBin));\n}\n\n\n/**\n * Accepts a tracker and adds the current version to the version param.\n * @param {Object} tracker An analytics.js tracker.\n */\nfunction trackVersion(tracker) {\n  tracker.set('&' + VERSION_PARAM, VERSION);\n}\n","/**\n * Copyright 2016 Google Inc. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\nexport const VERSION = '2.4.1';\nexport const DEV_ID = 'i5iSjo';\n\nexport const VERSION_PARAM = '_av';\nexport const USAGE_PARAM = '_au';\n\nexport const NULL_DIMENSION = '(not set)';\n","/**\n * Copyright 2016 Google Inc. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\nimport {DEV_ID} from './constants';\nimport {capitalize} from './utilities';\n\n\n/**\n * Provides a plugin for use with analytics.js, accounting for the possibility\n * that the global command queue has been renamed or not yet defined.\n * @param {string} pluginName The plugin name identifier.\n * @param {Function} pluginConstructor The plugin constructor function.\n */\nexport default function provide(pluginName, pluginConstructor) {\n  const gaAlias = window.GoogleAnalyticsObject || 'ga';\n  window[gaAlias] = window[gaAlias] || function(...args) {\n    (window[gaAlias].q = window[gaAlias].q || []).push(args);\n  };\n\n  // Adds the autotrack dev ID if not already included.\n  window.gaDevIds = window.gaDevIds || [];\n  if (window.gaDevIds.indexOf(DEV_ID) < 0) {\n    window.gaDevIds.push(DEV_ID);\n  }\n\n  // Formally provides the plugin for use with analytics.js.\n  window[gaAlias]('provide', pluginName, pluginConstructor);\n\n  // Registers the plugin on the global gaplugins object.\n  window.gaplugins = window.gaplugins || {};\n  window.gaplugins[capitalize(pluginName)] = pluginConstructor;\n}\n"]}