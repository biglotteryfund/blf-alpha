#!/usr/bin/env node
/* eslint-disable no-console */
'use strict';
const fs = require('fs');
const path = require('path');
const util = require('util');
const writeFile = util.promisify(fs.writeFile);

const { generateBehaviours } = require('../cloudfront/cloudfront-config');

['live', 'test'].forEach(async environment => {
    const behaviours = generateBehaviours(environment);
    try {
        const filePath = path.join(__dirname, `../cloudfront/${environment}.json`);
        await writeFile(filePath, JSON.stringify(behaviours, null, 2), 'utf8');
        console.log(
            `[${environment}] Cloudfront configuration with ${
                behaviours.CacheBehaviors.Items.length
            } behaviours saved at ${path.relative(process.cwd(), filePath)}.`
        );
    } catch (error) {
        console.error('Error saving config', error);
    }
});
